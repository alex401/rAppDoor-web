angular.module('rAppDoor',[])
.filter('custom', function() {
  return function(input, search) {
    if (!input) return input;
    if (!search) return input;
    var expected = ('' + search).toLowerCase();
    var result = {};
    angular.forEach(input, function(value, key) {
      var actual = ('' + value).toLowerCase();
      if (actual.indexOf(expected) !== -1) {
        result[key] = value;
      }
    });
    return result;
  }
});

var app = angular.module('rAppDoor', ['ui.bootstrap', 'ui.router']);

//used to use ngCookie but ended up with ipCookie, need to check what's up with that.

'use strict';

/**
 * Route configuration
 */
angular.module('rAppDoor').config(['$stateProvider', '$urlRouterProvider','$locationProvider',
    function($stateProvider, $urlRouterProvider, $locationProvider) {

        // For unmatched routes
        $urlRouterProvider.otherwise('/');
        $locationProvider.hashPrefix('');

        // Application routes
        $stateProvider
            .state('index', {
                url: '/',
                templateUrl: 'templates/dashboard.html'
            })
            .state('applications', {
                url: '/applications',
                templateUrl: 'templates/applications.html'
            })
            .state('help', {
                url: '/help',
                templateUrl: 'templates/help.html'
            })
            .state('trending', {
                url: '/trending',
                templateUrl: 'templates/trending.html'
            });
    }
]);

/**
 * rAppDoor API communication controller
 */

angular.module('rAppDoor')
    .controller('ApplicationCtrl', ['$scope', '$http', ApplicationCtrl]);

function ApplicationCtrl($scope, $http) {

// ****************************
// Initialise variables & scope
// ****************************
$scope.appsList =  [];
$scope.searchText = "";

// ****************************
// Load
// ****************************
  var Load = function () {
      loadAppsList();
      console.log("load appsCtrl")
  }

  // ****************************
  // load from API
  // ****************************

  var loadAppsList = function () {
    $http({
      method: 'GET',
      url: 'http://localhost:3000/api/applications'
    }).then(function successCallback(response) {
      $scope.appsList = response.data;
      console.log(response.data);
    //  console.log($scope.appsList);
      }, function errorCallback(response) {
        console.log("error");
      });
  }

  var loadAppMetrics = function () {
    $http({
      method: 'GET',
      url: 'http://localhost:3000/api/applications/metrics'
    }).then(function successCallback(response) {
      $scope.appsList = response.data;
      console.log(response.data);
    //  console.log($scope.appsList);
      }, function errorCallback(response) {
        console.log("error");
      });
  }


//will be replaced by something else
$scope.onSearch = function (s){
 $scope.searchText = s;
}


Load();

}

/**
 * Master Controller
 */

angular.module('rAppDoor')
    .controller('MasterCtrl', ['$scope', MasterCtrl]);

function MasterCtrl($scope) {

  // ****************************
  // Initialise variables & scope
  // ****************************
 $scope.controllerList = [];

 // ****************************
 // Load
 // ****************************

 // load list of controllers either from DB or API 


}

angular.module('rAppDoor').controller('ModalCtrl', function ($scope, $uibModal, $log) {

  $scope.items = ['item1', 'item2', 'item3'];


//  $scope.animationsEnabled = true;

  $scope.open = function (size) {

    var modalInstance = $uibModal.open({
      animation: 'true',
      templateUrl: 'addApp.html',
      controller: 'ModalAppCtrl',
      size: size,
      resolve: {
        items: function () {
          return $scope.items;
        }
      }
    });

    modalInstance.result.then(function (selectedItem) {
      $scope.selected = selectedItem;
    }, function () {
      $log.info('Modal dismissed at: ' + new Date());
    });
  };

  $scope.toggleAnimation = function () {
    $scope.animationsEnabled = !$scope.animationsEnabled;
  };

});

// Please note that $uibModalInstance represents a modal window (instance) dependency.
// It is not the same as the $uibModal service used above.

angular.module('rAppDoor').controller('ModalAppCtrl', function ($scope, $uibModalInstance, items) {

  $scope.items = items;
  $scope.selected = {
    item: $scope.items[0]
  };

  $scope.ok = function () {
    $uibModalInstance.close($scope.selected.item);
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };
});
